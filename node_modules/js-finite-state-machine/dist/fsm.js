(()=>{"use strict";function t(){return this.clear(),this}t.prototype.isFunction=function(t){return!(!t||"function"!=typeof t)},t.prototype.getCallback=function(){return this.callback},t.prototype.setCallback=function(t){return this.isFunction(t)&&(this.callback=t),this.enabled=!1,this.callback&&(this.enabled=!0),this},t.prototype.isEnabled=function(){return this.enabled},t.prototype.clear=function(){this.callback=null,this.enabled=!1};const e=t;function n(t,e){if(t!==e)throw new TypeError("Cannot instantiate an arrow function")}function i(t){var n=(new Date).getTime();return this.id=t&&t.id||"fsm_lifecycle_id_".concat(n),this.name=t&&t.name||"fsm_lifecycle_name_".concat(n),this.entity=t&&t.entity||null,this.states=t&&t.states||[],this.from=t&&t.from||null,this.to=t&&t.to||null,this.eventEmitter=new e,this.setTransitions(t&&t.transitions||[]),this}i.prototype.getLifecycleId=function(){return this.id},i.prototype.setLifecycleId=function(t){return t&&(this.id=t),this},i.prototype.getLifecycleName=function(){return this.name},i.prototype.setLifecycleName=function(t){return t&&(this.name=t),this},i.prototype.getEntity=function(){return this.entity},i.prototype.setEntity=function(t){return t&&(this.entity=t),this},i.prototype.getEntityId=function(){return this.entity&&this.entity.getEntityId()},i.prototype.getEntityName=function(){return this.entity&&this.entity.getEntityName()},i.prototype.getEntityState=function(){var t=this.getEntity();return t&&t.getEntityState()},i.prototype.setEntityState=function(t){if(t){var e=this.getEntity();e&&e.setEntityState(t)}return this},i.prototype.getEntityStateFrom=function(){return this.from},i.prototype.setEntityStateFrom=function(t){return t&&(this.from=t),this},i.prototype.getEntityStateTo=function(){return this.to},i.prototype.setEntityStateTo=function(t){return t&&(this.to=t),this},i.prototype.getStates=function(){return this.states},i.prototype.getStateById=function(t){var e=this;return t?this.states.find(function(i){return n(this,e),i.getStateId()===t}.bind(this)):null},i.prototype.getStateByName=function(t){var e=this;return t?this.states.find(function(i){return n(this,e),i.getStateName()===t}.bind(this)):null},i.prototype.setStates=function(t){return t&&(this.states=t),this},i.prototype.getTransitions=function(){return this.transitions},i.prototype.setTransitions=function(t){var e=this;return t&&(this.transitions=t,this.transitions.forEach(function(t){return n(this,e),this.addTransition(t)}.bind(this))),this},i.prototype.addTransition=function(t){var e=t&&t.getTransitionName();if(e)return this[e]=t,this},i.prototype.hasTransition=function(t){var e=t?"string"==typeof t?t:t.getTransitionName():null;return!(!e||!this[e])},i.prototype.run=function(t,e){var i=this,r=t?"string"==typeof t?t:t.getTransitionName():null,o=r&&this[r];if(o){var s=o&&o.getTransitionFrom(),a=this.entity&&this.entity.getEntityState();(a&&s.includes(a)||0===s.length)&&setTimeout(function(){return n(this,i),this.execute(o,e)}.bind(this),0)}},i.prototype.execute=function(t,e){var n=this.getEntityState(),i=n&&n.getStateName(),r=t.getTransitionTo(),o=r&&r.getStateName(),s=this.getStateByName(o);this.trigger(t.getEvents().before.value,t,e),t.before(n,s,e),n&&(this.trigger(n.getEvents().leave.value,t,e),n.leave(n,this.entity,e)),this.trigger(t.getEvents().start.value,t,e),t.start(n,s,e),this.setEntityState(s||null),i&&o&&(this.setEntityStateFrom(n.getStateName()),this.setEntityStateTo(s.getStateName()),this.trigger(n.getEvents().left.value,t,e),n.left(n,this.entity,e),this.trigger(s.getEvents().enter.value,t,e),s.enter(s,this.entity,e),this.trigger(s.getEvents().reached.value,t,e),s.reached(s,this.entity,e),this.trigger(s.getEvents().entered.value,t,e),s.entered(s,this.entity,e)),this.trigger(t.getEvents().after.value,t,e),t.after(n,s,e)},i.prototype.trigger=function(t,e,n){this.eventEmitter.isEnabled()&&this.eventEmitter.getCallback()(t,e,n)},i.prototype.setEventCallback=function(t){this.eventEmitter.setCallback(t)},i.prototype.resetEventCallback=function(){this.eventEmitter.clear()},i.prototype.getEventEmitter=function(){return this.eventEmitter};const r=i;function o(t){var e=(new Date).getTime();this.id=t&&t.id||"fsm_entity_id_".concat(e),this.name=t&&t.name||"fsm_entity_name_".concat(e);var n=t&&t.state||null;return n&&n.setEntityId(this.id),this.state=n,this}o.prototype.getEntityId=function(){return this.id},o.prototype.setEntityId=function(t){return t&&(this.id=t),this},o.prototype.getEntityName=function(){return this.name},o.prototype.setEntityName=function(t){return t&&(this.name=t),this},o.prototype.getEntityState=function(){return this.state},o.prototype.setEntityState=function(t){return t&&(t.setEntityId(this.id),this.state=t),this},o.prototype.getEntityStateName=function(){return this.state&&this.state.getStateName()},o.prototype.getEntityStateId=function(){return this.state&&this.state.getStateId()};const s=o;function a(t,e){if(t!==e)throw new TypeError("Cannot instantiate an arrow function")}function h(t){var e=this,n=(new Date).getTime(),i=t&&t.id,o=t&&t.name,h=t&&t.callback||null;this.id=i||"fsm_id_".concat(n),this.name=o||"fsm_name_".concat(n);var u={id:i?"".concat(i,"_entity"):null,name:o?"".concat(o,"_entity"):null};u.entity=t&&t.entity||new s(u),u.states=t&&t.states||[];var c=u.entity.getEntityId();return u.states.forEach(function(t){return a(this,e),t.setEntityId(c)}.bind(this)),u.transitions=t&&t.transitions||[],this.lifecycle=new r(u),u.transitions.forEach(function(t){var n=this;a(this,e),t.setEntityId(c),this[t&&t.getTransitionName()]=function(e){return a(this,n),this.lifecycle.run(t,e)}.bind(this)}.bind(this)),this.lifecycle.setEventCallback(h),this}h.prototype.getFSMId=function(){return this.id},h.prototype.setFSMId=function(t){return t&&(this.id=t),this},h.prototype.getFSMName=function(){return this.name},h.prototype.setFSMName=function(t){return t&&(this.name=t),this},h.prototype.getEntity=function(){return this.lifecycle.getEntity()},h.prototype.getEntityId=function(){return this.lifecycle.getEntityId()},h.prototype.getEntityName=function(){return this.lifecycle.getEntityName()},h.prototype.setEntityState=function(t){this.lifecycle.setEntityState(t)},h.prototype.getEntityState=function(){return this.lifecycle.getEntityState()},h.prototype.setStates=function(t){this.lifecycle.setStates(t)},h.prototype.getStates=function(){return this.lifecycle.getStates()},h.prototype.setTransitions=function(t){this.lifecycle.setTransitions(t)},h.prototype.getTransitions=function(){return this.lifecycle.getTransitions()},h.prototype.setEventCallback=function(t){this.lifecycle.setEventCallback(t)},h.prototype.resetEventCallback=function(){this.lifecycle.resetEventCallback()},h.prototype.getEventEmitter=function(){return this.lifecycle.getEventEmitter()};const u=h;var c=Object.freeze({enter:{id:"enter",value:"state.enter"},leave:{id:"leave",value:"state.leave"},entered:{id:"entered",value:"state.entered"},left:{id:"left",value:"state.left"},reached:{id:"reached",value:"state.reached"}});function f(t){var e=(new Date).getTime();return this.id=t&&t.id||"fsm_state_id_".concat(e),this.name=t&&t.name||"fsm_state_name_".concat(e),this.entityId=t&&t.entityId||null,this.methods={},this.setMethods(t&&t.methods),this}f.prototype.getStateId=function(){return this.id},f.prototype.setStateId=function(t){return t&&(this.id=t),this},f.prototype.getStateName=function(){return this.name},f.prototype.setStateName=function(t){return t&&(this.name=t),this},f.prototype.getEntityId=function(){return this.entityId},f.prototype.setEntityId=function(t){return t&&(this.entityId=t),this},f.prototype.getMethods=function(){return this.methods},f.prototype.getEvents=function(){return c},f.prototype.setMethodEnter=function(t){return t&&(this.methods.enter=t),this},f.prototype.setMethodLeave=function(t){return t&&(this.methods.leave=t),this},f.prototype.setMethodEntered=function(t){return t&&(this.methods.entered=t),this},f.prototype.setMethodLeft=function(t){return t&&(this.methods.left=t),this},f.prototype.setMethodReached=function(t){return t&&(this.methods.reached=t),this},f.prototype.setMethods=function(t){var e=t||{};return this.setMethodEnter(e.enter||function(){return!0}),this.setMethodLeave(e.leave||function(){return!0}),this.setMethodEntered(e.entered||function(){return!0}),this.setMethodLeft(e.left||function(){return!0}),this.setMethodReached(e.reached||function(){return!0}),this},f.prototype.enter=function(t,e){return this.methods.enter.apply(this,arguments)},f.prototype.leave=function(t,e){return this.methods.leave.apply(this,arguments)},f.prototype.reached=function(t,e){return this.methods.reached.apply(this,arguments)},f.prototype.entered=function(t,e){return this.methods.entered.apply(this,arguments)},f.prototype.left=function(t,e){return this.methods.left.apply(this,arguments)};const p=f;var y=Object.freeze({before:{id:"before",value:"transition.before"},after:{id:"after",value:"transition.after"},start:{id:"start",value:"transition.start"}});function d(t){var e=(new Date).getTime();return this.id=t&&t.id||"fsm_transition_id_".concat(e),this.name=t&&t.name||"fsm_transition_name_".concat(e),this.entityId=t&&t.entityId||null,this.from=t&&t.from||[],this.to=t&&t.to||null,this.methods={},this.setMethods(t&&t.methods),this}d.prototype.getTransitionId=function(){return this.id},d.prototype.setTransitionId=function(t){return t&&(this.id=t),this},d.prototype.getTransitionName=function(){return this.name},d.prototype.setTransitionName=function(t){return t&&(this.name=t),this},d.prototype.getEntityId=function(){return this.entityId},d.prototype.setEntityId=function(t){return t&&(this.entityId=t),this},d.prototype.getTransitionFrom=function(){return this.from},d.prototype.setTransitionFrom=function(t){return t&&(this.from=t),this},d.prototype.addStates=function(t){var e=this,n=t&&t.constructor;return n&&"Array"===n.name&&t.forEach(function(t){return function(t,e){if(t!==e)throw new TypeError("Cannot instantiate an arrow function")}(this,e),this.from.push(t)}.bind(this)),this},d.prototype.getTransitionTo=function(){return this.to},d.prototype.setTransitionTo=function(t){return t&&(this.to=t),this},d.prototype.getMethods=function(){return this.methods},d.prototype.getEvents=function(){return y},d.prototype.setMethodBefore=function(t){return t&&(this.methods.before=t),this},d.prototype.setMethodAfter=function(t){return t&&(this.methods.after=t),this},d.prototype.setMethodStart=function(t){return t&&(this.methods.start=t),this},d.prototype.setMethods=function(t){var e=t||{};return this.setMethodBefore(e.before||function(){return!0}),this.setMethodAfter(e.after||function(){return!0}),this.setMethodStart(e.start||function(){return!0}),this},d.prototype.before=function(t,e){return this.methods.before.apply(this,arguments)},d.prototype.after=function(t,e){return this.methods.after.apply(this,arguments)},d.prototype.start=function(t,e,n){return this.methods.start.apply(this,arguments)};const l=d;u.Entity=s,u.State=p,u.Transition=l,window.FSM=u})();